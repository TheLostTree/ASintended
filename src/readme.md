wip typed rewrite (probably not happening anytime soon lmfao)